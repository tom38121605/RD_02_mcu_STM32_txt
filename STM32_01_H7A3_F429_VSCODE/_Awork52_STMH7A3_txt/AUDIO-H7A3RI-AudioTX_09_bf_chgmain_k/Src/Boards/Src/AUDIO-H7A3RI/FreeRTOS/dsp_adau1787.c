/**
 * @file      dsp_adau1787.c
 *
 * @brief     
 *
 * @author    Decawave Applications
 *
 * @attention Copyright (c) 2021 - 2022, Qorvo US, Inc.
 * All rights reserved
 * Redistribution and use in source and binary forms, with or without modification,
 *  are permitted provided that the following conditions are met:
 * 1. Redistributions of source code must retain the above copyright notice, this
 *  list of conditions, and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *  this list of conditions and the following disclaimer in the documentation
 *  and/or other materials provided with the distribution.
 * 3. You may only use this software, with or without any modification, with an
 *  integrated circuit developed by Qorvo US, Inc. or any of its affiliates
 *  (collectively, "Qorvo"), or any module that contains such integrated circuit.
 * 4. You may not reverse engineer, disassemble, decompile, decode, adapt, or
 *  otherwise attempt to derive or gain access to the source code to any software
 *  distributed under this license in binary or object code form, in whole or in
 *  part.
 * 5. You may not use any Qorvo name, trademarks, service marks, trade dress,
 *  logos, trade names, or other symbols or insignia identifying the source of
 *  Qorvo's products or services, or the names of any of Qorvo's developers to
 *  endorse or promote products derived from this software without specific prior
 *  written permission from Qorvo US, Inc. You must not call products derived from
 *  this software "Qorvo", you must not have "Qorvo" appear in their name, without
 *  the prior permission from Qorvo US, Inc.
 * 6. Qorvo may publish revised or new version of this license from time to time.
 *  No one other than Qorvo US, Inc. has the right to modify the terms applicable
 *  to the software provided under this license.
 * THIS SOFTWARE IS PROVIDED BY QORVO US, INC. "AS IS" AND ANY EXPRESS OR IMPLIED
 *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. NEITHER
 *  QORVO, NOR ANY PERSON ASSOCIATED WITH QORVO MAKES ANY WARRANTY OR
 *  REPRESENTATION WITH RESPECT TO THE COMPLETENESS, SECURITY, RELIABILITY, OR
 *  ACCURACY OF THE SOFTWARE, THAT IT IS ERROR FREE OR THAT ANY DEFECTS WILL BE
 *  CORRECTED, OR THAT THE SOFTWARE WILL OTHERWISE MEET YOUR NEEDS OR EXPECTATIONS.
 * IN NO EVENT SHALL QORVO OR ANYBODY ASSOCIATED WITH QORVO BE LIABLE FOR ANY
 *  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 *  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 *  ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 *
 */

#include "stm32h7xx_hal.h"
#include "dsp_adau1787.h"
#include "audio_dsp.h"
#include "string.h"

static uint16_t dsp_i2c_address = (0x28 << 1);
extern I2C_HandleTypeDef hi2c4;

struct adau1787_reg_data
{
	uint16_t	reg_16bit;
	uint8_t		data_8bit;
};
struct adau1787_reg_data	reg_data[DSP_REG_DATA_LENGTH];
uint8_t Program_Data_5000[DSP_PROGRAM_DATA_5000_LENGTH];
uint8_t Parameter_Data_2000[DSP_PARAMETER_DATA_2000_LENGTH];
struct adau1787_reg_data	reg_data2[DSP_REG_DATA_2_LENGTH]; 


//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
 //0xC03B	0x01 to 0x00 for separate DAC0 with DAC1 value

//Please add this define value to the end of  main.c
struct adau1787_reg_data	reg_data[DSP_REG_DATA_LENGTH] = {
	{ 0xC081,	0x00 }, 
	{ 0xC03C,	0xFD }, 
	{ 0xC03D,	0xFD }, 
	{ 0xC004,	0x00 }, 
	{ 0xC005,	0xFE }, 
	{ 0xC006,	0x00 }, 
	{ 0xC007,	0x23 }, 
	{ 0xC00D,	0x17 }, 
	{ 0xC00E,	0xC8 }, 
	{ 0xC00F,	0x00 }, 
	{ 0xC010,	0x00 }, 
	{ 0xC011,	0x02 },
	{ 0xC012,	0x00 }, 
	{ 0xC013,	0x00 },
	{ 0xC014,	0x00 }, 
	{ 0xC015,	0x00 },
	{ 0xC016,	0x01 }, 
	{ 0xC005,	0xFF }, 
	{ 0xC016,	0x00 }, 
	{ 0xC008,	0x01 }, 
	{ 0xC008,	0x11 }, 
	{ 0xC006,	0x0F }, 
	{ 0xC007,	0x3F }, 
	{ 0xC009,	0xFF }, 
	{ 0xC00A,	0xFF }, 
	{ 0xC00B,	0xFF }, 
	{ 0xC00C,	0x03 }, 
	{ 0xC017,	0x2A }, 
	{ 0xC018,	0x00 }, 
	{ 0xC019,	0x03 }, 
	{ 0xC01A,	0x40 }, 
	{ 0xC01B,	0x26 }, 
	{ 0xC01C,	0x00 }, 
	{ 0xC01D,	0x40 }, 
	{ 0xC01E,	0x40 }, 
	{ 0xC01F,	0x40 }, 
	{ 0xC020,	0x40 }, 
	{ 0xC021,	0x00 }, 
	{ 0xC022,	0x00 }, 
	{ 0xC023,	0x00 }, 
	{ 0xC024,	0x00 }, 
	{ 0xC025,	0x00 }, 
	{ 0xC026,	0x00 }, 
	{ 0xC027,	0x00 }, 
	{ 0xC028,	0x00 }, 
	{ 0xC029,	0x00 }, 
	{ 0xC02A,	0x20 }, 
	{ 0xC02B,	0x33 }, 
	{ 0xC02C,	0x01 }, 
	{ 0xC02D,	0x01 }, 
	{ 0xC02E,	0x01 }, 
	{ 0xC02F,	0x00 }, 
	{ 0xC030,	0x04 }, 
	{ 0xC031,	0x00 }, 
	{ 0xC032,	0x10 }, 
	{ 0xC033,	0x10 }, 
	{ 0xC034,	0x10 }, 
	{ 0xC035,	0x10 }, 
	{ 0xC036,	0x10 }, 
	{ 0xC037,	0x10 }, 
	{ 0xC038,	0x40 }, 
	{ 0xC039,	0x40 }, 
	{ 0xC03A,	0x0A }, 
	{ 0xC03B,	0x01 }, 
	{ 0xC03E,	0x30 }, 
	{ 0xC03F,	0x31 }, 
	{ 0xC040,	0x11 }, 
	{ 0xC041,	0x22 }, 
	{ 0xC042,	0x22 }, 
	{ 0xC043,	0x22 }, 
	{ 0xC044,	0x22 }, 
	{ 0xC045,	0x12 }, 
	{ 0xC046,	0x03 }, 
	{ 0xC047,	0x00 }, 
	{ 0xC048,	0x00 }, 
	{ 0xC049,	0x00 }, 
	{ 0xC04A,	0x00 }, 
	{ 0xC04B,	0x00 }, 
	{ 0xC04C,	0x00 }, 
	{ 0xC04D,	0x62 }, 
	{ 0xC04E,	0x62 }, 
	{ 0xC04F,	0x52 }, 
	{ 0xC050,	0x52 }, 
	{ 0xC051,	0x30 }, 
	{ 0xC052,	0x31 }, 
	{ 0xC053,	0x00 }, 
	{ 0xC054,	0x00 }, 
	{ 0xC055,	0x00 }, 
	{ 0xC056,	0x00 }, 
	{ 0xC057,	0x00 }, 
	{ 0xC058,	0x00 }, 
	{ 0xC059,	0x02 }, 
	{ 0xC05A,	0x00 }, 
	{ 0xC05B,	0x00 }, 
	{ 0xC05C,	0x02 }, 
	{ 0xC05D,	0x12 }, 
	{ 0xC05E,	0x13 }, 
	{ 0xC05F,	0x00 }, 
	{ 0xC060,	0x00 }, 
	{ 0xC062,	0x70 }, 
	{ 0xC063,	0x3F }, 
	{ 0xC064,	0x00 }, 
	{ 0xC065,	0x11 }, 
	{ 0xC066,	0x00 }, 
	{ 0xC067,	0x7F },
	{ 0xC068,	0x00 }, 
	{ 0xC069,	0x00 }, 
	{ 0xC06A,	0x00 }, 
	{ 0xC06B,	0x00 }, 
	{ 0xC06C,	0x00 },
	{ 0xC06D,	0x00 },
	{ 0xC06E,	0x00 },
	{ 0xC06F,	0x00 }, 
	{ 0xC070,	0x00 },
	{ 0xC071,	0x00 },
	{ 0xC072,	0x00 },
	{ 0xC073,	0x00 }, 
	{ 0xC074,	0x00 },
	{ 0xC075,	0x00 },
	{ 0xC076,	0x00 },
	{ 0xC077,	0x00 }, 
	{ 0xC078,	0x00 },
	{ 0xC079,	0x00 },
	{ 0xC07A,	0x00 },
	{ 0xC07B,	0x00 }, 
	{ 0xC07C,	0x00 },
	{ 0xC07D,	0x00 },
	{ 0xC07E,	0x00 },
	{ 0xC07F,	0x00 }, 
	{ 0xC080,	0x11 }, 
	{ 0xC082,	0x00 }, 
	{ 0xC083,	0x00 }, 
	{ 0xC084,	0x00 },
	{ 0xC085,	0x00 },
	{ 0xC086,	0x07 }, 
	{ 0xC087,	0xF4 },
	{ 0xC088,	0x07 }, 
	{ 0xC089,	0xFF },
	{ 0xC08A,	0x0F }, 
	{ 0xC08B,	0x00 }, 
	{ 0xC08C,	0x00 }, 
	{ 0xC08D,	0x00 }, 
	{ 0xC08E,	0x00 }, 
	{ 0xC08F,	0x00 }, 
	{ 0xC090,	0x00 }, 
	{ 0xC091,	0x10 }, 
	{ 0xC092,	0x00 }, 
	{ 0xC093,	0x00 }, 
	{ 0xC094,	0x05 }, 
	{ 0xC095,	0x05 }, 
	{ 0xC096,	0x04 }, 
	{ 0xC097,	0x05 }, 
	{ 0xC098,	0x05 }, 
	{ 0xC099,	0x05 }, 
	{ 0xC09A,	0x05 }, 
	{ 0xC09B,	0x05 }, 
	{ 0xC09C,	0x00 }, 
	{ 0xC09D,	0x05 }, 
	{ 0xC09E,	0x04 }, 
	{ 0xC09F,	0x00 }, 
	{ 0xC0A0,	0x00 }, 
	{ 0xC0A1,	0x00 }, 
	{ 0xC0A2,	0xF3 }, 
	{ 0xC0A3,	0xFF }, 
	{ 0xC0A4,	0x1F }, 
	{ 0xC0A5,	0xF3 }, 
	{ 0xC0A6,	0xFF }, 
	{ 0xC0A7,	0x1F }, 
	{ 0xC0A8,	0x00 }, 
	{ 0xC0A9,	0x3F }, 
	{ 0xC0AA,	0x00 }, 
	{ 0xC0AB,	0x00 }, 
	{ 0xC0AC,	0x00 }, 
	{ 0xC0AD,	0x00 }, 
	{ 0xC0AE,	0x00 }, 
	{ 0xC0AF,	0x00 }, 
	{ 0xC0B0,	0x00 }, 
	{ 0xC0B1,	0x00 }, 
	{ 0xC0B2,	0x00 }, 
	{ 0xC0B3,	0x00 }, 
	{ 0xC0B4,	0x00 }, 
	{ 0xC0B5,	0x00 }, 
	{ 0xC0B6,	0x00 }, 
	{ 0xC0B7,	0x10 }, 
	{ 0xC0B8,	0x11 }, 
	{ 0xC0B9,	0x3F }, 
	{ 0xC0BA,	0x3F }, 
	{ 0xC0BB,	0x3F }, 
	{ 0xC0BC,	0x3F }, 
	{ 0xC0BD,	0x3F }, 
	{ 0xC0BE,	0x3F }, 
	{ 0xC0BF,	0x3F }, 
	{ 0xC0C0,	0x3F }, 
	{ 0xC0C1,	0x3F }, 
	{ 0xC0C2,	0x3F }, 
	{ 0xC0C3,	0x3F }, 
	{ 0xC0C4,	0x3F }, 
	{ 0xC0C5,	0x3F }, 
	{ 0xC0C6,	0x3F }, 
	{ 0xC0C7,	0x00 }, 
	{ 0xC0C8,	0x00 }, 
	{ 0xC0C9,	0x10 }, 
	{ 0xC0CA,	0x11 }, 
	{ 0xC0CB,	0x3F }, 
	{ 0xC0CC,	0x3F }, 
	{ 0xC0CD,	0x3F }, 
	{ 0xC0CE,	0x3F }, 
	{ 0xC0CF,	0x3F }, 
	{ 0xC0D0,	0x3F }, 
	{ 0xC0D1,	0x3F }, 
	{ 0xC0D2,	0x3F }, 
	{ 0xC0D3,	0x3F }, 
	{ 0xC0D4,	0x3F }, 
	{ 0xC0D5,	0x3F }, 
	{ 0xC0D6,	0x3F }, 
	{ 0xC0D7,	0x3F }, 
	{ 0xC0D8,	0x3F }, 
	{ 0xC0D9,	0x01 }, 
	{ 0xC0DA,	0x41 }, 
	{ 0xC0DB,	0x41 }, 
	{ 0xC0DC,	0x13 }, 
	{ 0xC0DD,	0xC5 }, 
	{ 0xC0DE,	0x4C }, 
	{ 0xC0DF,	0x48 }, 
	{ 0xC0E0,	0x00 }, 
	{ 0xC0E1,	0x01 } 
}; 
uint8_t Program_Data_5000[DSP_PROGRAM_DATA_5000_LENGTH] ={ 
	0x00,0x00,0x00,0x00,0x00,0x91,0xC0,0x00,0x00,0x00,
	0x92,0x68,0x00,0x00,0x00,0x92,0x58,0x00,0x00,0x00,
	0x92,0xA8,0x00,0x00,0x00,0x92,0xB8,0x00,0x00,0x00,
	0xFF,0xE9,0x08,0x20,0x00,0x92,0x70,0x00,0x00,0x00,
	0x93,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x91,0xD0,0x0C,0x00,0x00,
	0x90,0x60,0x00,0xE2,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xD0,0x07,0x20,0x08,
	0xFF,0xD9,0x0A,0x20,0x00,0x00,0x00,0x00,0xE2,0x00,
	0x00,0x00,0x06,0xA0,0x00,0xFF,0xC0,0x00,0xC0,0x00,
	0x00,0x0B,0xFF,0x40,0x00,0x91,0x80,0x25,0x00,0x27,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x44,0x40,
	0x93,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0xE4,0x00,
	0x00,0x00,0x00,0xC0,0x00,0x92,0x00,0x00,0x00,0x00,
	0x91,0xD0,0x21,0x00,0x00,0xFF,0xD0,0x01,0x20,0x00,
	0xFF,0xB0,0x01,0x03,0x00,0x00,0x09,0xDE,0x00,0x00,
	0x92,0x10,0x00,0x00,0x00,0xFF,0xE8,0x00,0x20,0x00,
	0xFF,0xB0,0x07,0x02,0x00,0x80,0x09,0x08,0x20,0x00,
	0x00,0x10,0x00,0xE2,0x00,0x80,0x19,0x08,0x20,0x00,
	0x00,0x20,0x00,0xE2,0x00,0x80,0x29,0x08,0x20,0x00,
	0x00,0x30,0x00,0xE2,0x00,0x80,0x39,0x08,0x20,0x00,
	0x00,0x40,0x00,0xE2,0x00,0x80,0x49,0x08,0x20,0x00,
	0x00,0x50,0x00,0xE2,0x00,0x80,0x59,0x08,0x20,0x00,
	0x00,0x60,0x00,0xE2,0x00,0x80,0x69,0x08,0x20,0x00,
	0x00,0x70,0x00,0xE2,0x00,0x80,0x79,0x08,0x20,0x00,
	0x00,0x80,0x00,0xE2,0x00,0x82,0x09,0x08,0x20,0x00,
	0x00,0x90,0x00,0xE2,0x00,0x82,0x19,0x08,0x20,0x00,
	0x00,0xA0,0x00,0xE2,0x00,0xFF,0xD0,0x09,0x20,0x00,
	0x01,0x20,0x00,0xE2,0x00,0x00,0x59,0x08,0x20,0x00,
	0x00,0xD0,0x00,0xE2,0x00,0x00,0x69,0x08,0x20,0x00,
	0x00,0xF0,0x00,0xE2,0x00,0x00,0x79,0x08,0x20,0x00,
	0x00,0xE0,0x00,0xE2,0x00,0x00,0x89,0x08,0x20,0x00,
	0x01,0x00,0x00,0xE2,0x00,0xFF,0xE9,0x08,0x20,0x00,
	0x01,0xD0,0x00,0xE2,0x00,0x01,0x19,0x08,0x20,0x00,
	0x01,0x29,0x08,0x22,0x48,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xD9,0x08,0x20,0x26,0x01,0xD0,0x00,0xE2,0x00,
	0x01,0x59,0x08,0x20,0x00,0xFF,0xD9,0x13,0x22,0x48,
	0x01,0x19,0x08,0x20,0x00,0x01,0x99,0x08,0x20,0x25,
	0x01,0xA0,0x00,0xE2,0x00,0x01,0x79,0x08,0x20,0x00,
	0xFF,0xD9,0x13,0x22,0x48,0x01,0x19,0x08,0x20,0x00,
	0x01,0xB9,0x08,0x20,0x25,0x01,0xC0,0x00,0xE2,0x00,
	0x01,0xE9,0x08,0x20,0x00,0x00,0x00,0x00,0x00,0x00,
	0x02,0x00,0x00,0xF0,0x00,0x02,0x09,0x08,0x20,0x00,
	0xFF,0xD9,0x13,0x22,0x48,0x01,0xD9,0x08,0x20,0x00,
	0xFF,0xE9,0x08,0x20,0x25,0x01,0xD0,0x00,0xE2,0x00,
	0x01,0x19,0x08,0x20,0x00,0x01,0x20,0x00,0xE2,0x25,
	0x01,0x39,0x08,0x20,0x00,0x01,0x59,0x08,0x22,0x40,
	0x01,0xF0,0x00,0xE2,0x00,0x01,0x59,0x08,0x20,0x00,
	0x01,0xF9,0x14,0x22,0x00,0x01,0x60,0x00,0xE2,0x00,
	0x01,0xA0,0x00,0xC0,0x00,0x00,0x0B,0xFF,0xA0,0x00,
	0x01,0x60,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xDB,0xFF,0x20,0x80,0x00,0xB0,0x00,0xE2,0x00,
	0x00,0xFB,0xFF,0x40,0x80,0x00,0xC0,0x00,0xE4,0x00,
	0xFF,0xD9,0x08,0x20,0x00,0xFF,0xDB,0xFF,0x22,0x40,
	0x01,0x80,0x00,0xE2,0x00,0x01,0xC0,0x00,0xC0,0x00,
	0x00,0x0B,0xFF,0xA0,0x00,0x01,0x80,0x00,0xC0,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0xDB,0xFF,0x20,0x80,
	0x00,0xB9,0x08,0x22,0x00,0x00,0xB0,0x00,0xE2,0x00,
	0x00,0xFB,0xFF,0x40,0x80,0x00,0xC9,0x08,0x44,0x00,
	0x00,0xC0,0x00,0xE4,0x00,0x01,0x39,0x08,0x20,0x00,
	0x01,0xD9,0x08,0x22,0x40,0x00,0x00,0x00,0x00,0x00,
	0x01,0x40,0x00,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xD0,0x0A,0x20,0x00,0x02,0x80,0x00,0xE2,0x00,
	0x00,0x19,0x08,0x20,0x00,0x02,0x30,0x00,0xE2,0x00,
	0x00,0x29,0x08,0x20,0x00,0x02,0x50,0x00,0xE2,0x00,
	0x00,0x39,0x08,0x20,0x00,0x02,0x40,0x00,0xE2,0x00,
	0x00,0x49,0x08,0x20,0x00,0x02,0x60,0x00,0xE2,0x00,
	0xFF,0xE9,0x08,0x20,0x00,0x03,0x30,0x00,0xE2,0x00,
	0x02,0x79,0x08,0x20,0x00,0x02,0x89,0x08,0x22,0x48,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xD9,0x08,0x20,0x26,
	0x03,0x30,0x00,0xE2,0x00,0x02,0xB9,0x08,0x20,0x00,
	0xFF,0xD9,0x13,0x22,0x48,0x02,0x79,0x08,0x20,0x00,
	0x02,0xF9,0x08,0x20,0x25,0x03,0x00,0x00,0xE2,0x00,
	0x02,0xD9,0x08,0x20,0x00,0xFF,0xD9,0x13,0x22,0x48,
	0x02,0x79,0x08,0x20,0x00,0x03,0x19,0x08,0x20,0x25,
	0x03,0x20,0x00,0xE2,0x00,0x03,0x49,0x08,0x20,0x00,
	0x00,0x00,0x00,0x00,0x00,0x03,0x60,0x00,0xF0,0x00,
	0x03,0x69,0x08,0x20,0x00,0xFF,0xD9,0x13,0x22,0x48,
	0x03,0x39,0x08,0x20,0x00,0xFF,0xE9,0x08,0x20,0x25,
	0x03,0x30,0x00,0xE2,0x00,0x02,0x79,0x08,0x20,0x00,
	0x02,0x80,0x00,0xE2,0x25,0x02,0x99,0x08,0x20,0x00,
	0x02,0xB9,0x08,0x22,0x40,0x03,0x50,0x00,0xE2,0x00,
	0x02,0xB9,0x08,0x20,0x00,0x03,0x59,0x14,0x22,0x00,
	0x02,0xC0,0x00,0xE2,0x00,0x03,0x00,0x00,0xC0,0x00,
	0x00,0x0B,0xFF,0xA0,0x00,0x02,0xC0,0x00,0xC0,0x00,
	0x00,0x00,0x00,0x00,0x00,0x02,0x3B,0xFF,0x20,0x80,
	0x02,0x10,0x00,0xE2,0x00,0x02,0x5B,0xFF,0x40,0x80,
	0x02,0x20,0x00,0xE4,0x00,0xFF,0xD9,0x08,0x20,0x00,
	0xFF,0xDB,0xFF,0x22,0x40,0x02,0xE0,0x00,0xE2,0x00,
	0x03,0x20,0x00,0xC0,0x00,0x00,0x0B,0xFF,0xA0,0x00,
	0x02,0xE0,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x02,0x3B,0xFF,0x20,0x80,0x02,0x19,0x08,0x22,0x00,
	0x02,0x10,0x00,0xE2,0x00,0x02,0x5B,0xFF,0x40,0x80,
	0x02,0x29,0x08,0x44,0x00,0x02,0x20,0x00,0xE4,0x00,
	0x02,0x99,0x08,0x20,0x00,0x03,0x39,0x08,0x22,0x40,
	0x00,0x00,0x00,0x00,0x00,0x02,0xA0,0x00,0xF0,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xD0,0x0B,0x20,0x00,
	0x03,0xE0,0x00,0xE2,0x00,0x02,0x19,0x08,0x20,0x00,
	0x03,0x90,0x00,0xE2,0x00,0x02,0x29,0x08,0x20,0x00,
	0x03,0xB0,0x00,0xE2,0x00,0x00,0xB9,0x08,0x20,0x00,
	0x03,0xA0,0x00,0xE2,0x00,0x00,0xC9,0x08,0x20,0x00,
	0x03,0xC0,0x00,0xE2,0x00,0xFF,0xE9,0x08,0x20,0x00,
	0x04,0x90,0x00,0xE2,0x00,0x03,0xD9,0x08,0x20,0x00,
	0x03,0xE9,0x08,0x22,0x48,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xD9,0x08,0x20,0x26,0x04,0x90,0x00,0xE2,0x00,
	0x04,0x19,0x08,0x20,0x00,0xFF,0xD9,0x13,0x22,0x48,
	0x03,0xD9,0x08,0x20,0x00,0x04,0x59,0x08,0x20,0x25,
	0x04,0x60,0x00,0xE2,0x00,0x04,0x39,0x08,0x20,0x00,
	0xFF,0xD9,0x13,0x22,0x48,0x03,0xD9,0x08,0x20,0x00,
	0x04,0x79,0x08,0x20,0x25,0x04,0x80,0x00,0xE2,0x00,
	0x04,0xA9,0x08,0x20,0x00,0x00,0x00,0x00,0x00,0x00,
	0x04,0xC0,0x00,0xF0,0x00,0x04,0xC9,0x08,0x20,0x00,
	0xFF,0xD9,0x13,0x22,0x48,0x04,0x99,0x08,0x20,0x00,
	0xFF,0xE9,0x08,0x20,0x25,0x04,0x90,0x00,0xE2,0x00,
	0x03,0xD9,0x08,0x20,0x00,0x03,0xE0,0x00,0xE2,0x25,
	0x03,0xF9,0x08,0x20,0x00,0x04,0x19,0x08,0x22,0x40,
	0x04,0xB0,0x00,0xE2,0x00,0x04,0x19,0x08,0x20,0x00,
	0x04,0xB9,0x14,0x22,0x00,0x04,0x20,0x00,0xE2,0x00,
	0x04,0x60,0x00,0xC0,0x00,0x00,0x0B,0xFF,0xA0,0x00,
	0x04,0x20,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x03,0x9B,0xFF,0x20,0x80,0x03,0x70,0x00,0xE2,0x00,
	0x03,0xBB,0xFF,0x40,0x80,0x03,0x80,0x00,0xE4,0x00,
	0xFF,0xD9,0x08,0x20,0x00,0xFF,0xDB,0xFF,0x22,0x40,
	0x04,0x40,0x00,0xE2,0x00,0x04,0x80,0x00,0xC0,0x00,
	0x00,0x0B,0xFF,0xA0,0x00,0x04,0x40,0x00,0xC0,0x00,
	0x00,0x00,0x00,0x00,0x00,0x03,0x9B,0xFF,0x20,0x80,
	0x03,0x79,0x08,0x22,0x00,0x03,0x70,0x00,0xE2,0x00,
	0x03,0xBB,0xFF,0x40,0x80,0x03,0x89,0x08,0x44,0x00,
	0x03,0x80,0x00,0xE4,0x00,0x03,0xF9,0x08,0x20,0x00,
	0x04,0x99,0x08,0x22,0x40,0x00,0x00,0x00,0x00,0x00,
	0x04,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x03,0x79,0x08,0x20,0x00,0x84,0xA0,0x00,0xE2,0x00,
	0x03,0x89,0x08,0x20,0x00,0x84,0xB0,0x00,0xE2,0x00,
	0xFF,0xD0,0x0C,0x20,0x00,0x05,0x40,0x00,0xE2,0x00,
	0x03,0x79,0x08,0x20,0x00,0x04,0xF0,0x00,0xE2,0x00,
	0x03,0x89,0x08,0x20,0x00,0x05,0x10,0x00,0xE2,0x00,
	0x00,0x99,0x08,0x20,0x00,0x05,0x00,0x00,0xE2,0x00,
	0x00,0xA9,0x08,0x20,0x00,0x05,0x20,0x00,0xE2,0x00,
	0xFF,0xE9,0x08,0x20,0x00,0x05,0xF0,0x00,0xE2,0x00,
	0x05,0x39,0x08,0x20,0x00,0x05,0x49,0x08,0x22,0x48,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xD9,0x08,0x20,0x26,
	0x05,0xF0,0x00,0xE2,0x00,0x05,0x79,0x08,0x20,0x00,
	0xFF,0xD9,0x13,0x22,0x48,0x05,0x39,0x08,0x20,0x00,
	0x05,0xB9,0x08,0x20,0x25,0x05,0xC0,0x00,0xE2,0x00,
	0x05,0x99,0x08,0x20,0x00,0xFF,0xD9,0x13,0x22,0x48,
	0x05,0x39,0x08,0x20,0x00,0x05,0xD9,0x08,0x20,0x25,
	0x05,0xE0,0x00,0xE2,0x00,0x06,0x09,0x08,0x20,0x00,
	0x00,0x00,0x00,0x00,0x00,0x06,0x20,0x00,0xF0,0x00,
	0x06,0x29,0x08,0x20,0x00,0xFF,0xD9,0x13,0x22,0x48,
	0x05,0xF9,0x08,0x20,0x00,0xFF,0xE9,0x08,0x20,0x25,
	0x05,0xF0,0x00,0xE2,0x00,0x05,0x39,0x08,0x20,0x00,
	0x05,0x40,0x00,0xE2,0x25,0x05,0x59,0x08,0x20,0x00,
	0x05,0x79,0x08,0x22,0x40,0x06,0x10,0x00,0xE2,0x00,
	0x05,0x79,0x08,0x20,0x00,0x06,0x19,0x14,0x22,0x00,
	0x05,0x80,0x00,0xE2,0x00,0x05,0xC0,0x00,0xC0,0x00,
	0x00,0x0B,0xFF,0xA0,0x00,0x05,0x80,0x00,0xC0,0x00,
	0x00,0x00,0x00,0x00,0x00,0x04,0xFB,0xFF,0x20,0x80,
	0x04,0xD0,0x00,0xE2,0x00,0x05,0x1B,0xFF,0x40,0x80,
	0x04,0xE0,0x00,0xE4,0x00,0xFF,0xD9,0x08,0x20,0x00,
	0xFF,0xDB,0xFF,0x22,0x40,0x05,0xA0,0x00,0xE2,0x00,
	0x05,0xE0,0x00,0xC0,0x00,0x00,0x0B,0xFF,0xA0,0x00,
	0x05,0xA0,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x04,0xFB,0xFF,0x20,0x80,0x04,0xD9,0x08,0x22,0x00,
	0x04,0xD0,0x00,0xE2,0x00,0x05,0x1B,0xFF,0x40,0x80,
	0x04,0xE9,0x08,0x44,0x00,0x04,0xE0,0x00,0xE4,0x00,
	0x05,0x59,0x08,0x20,0x00,0x05,0xF9,0x08,0x22,0x40,
	0x00,0x00,0x00,0x00,0x00,0x05,0x60,0x00,0xF0,0x00,
	0x00,0x00,0x00,0x00,0x00,0x04,0xD9,0x08,0x20,0x00,
	0x84,0x80,0x00,0xE2,0x00,0x04,0xE9,0x08,0x20,0x00,
	0x84,0x90,0x00,0xE2,0x00,0x00,0x00,0x00,0x00,0x00,
	0x90,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x91,0x80,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00
 };
uint8_t Parameter_Data_2000[DSP_PARAMETER_DATA_2000_LENGTH] ={ 
	0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x20,0x04,0x00,0x00,0x00,0x01,
	0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x01
 };
struct adau1787_reg_data	reg_data2[DSP_REG_DATA_2_LENGTH] = {
	{ 0xC061,	0x00 }, 
	{ 0xC061,	0x01 }, 
	{ 0xC004,	0x3F }, 
	{ 0xC03C,	0x40 }, 
	{ 0xC03D,	0x40 }, 
	{ 0xC081,	0x01 }, 
};

static uint8_t i2c_msg_buffer[100] = {0};
static uint8_t i2c_debug_buffer[100] = {0};

static HAL_StatusTypeDef audio_dsp_adau1787_reg_write(uint16_t reg_addr, uint8_t * reg_buffer, uint16_t length)
{
	i2c_msg_buffer[0] = reg_addr >> 8;
	i2c_msg_buffer[1] = reg_addr &  0xff;
	memcpy(i2c_msg_buffer + 2, reg_buffer, length);
	HAL_StatusTypeDef ret = HAL_I2C_Master_Transmit(&hi2c4, dsp_i2c_address, i2c_msg_buffer, length + 2, 2);
	assert(ret == HAL_OK);
	return ret;
}

static HAL_StatusTypeDef audio_dsp_adau1787_reg_check(uint16_t reg_addr, uint8_t * reg_buffer, uint16_t length)
{
	i2c_msg_buffer[0] = reg_addr >> 8;
	i2c_msg_buffer[1] = reg_addr &  0xff;
	HAL_StatusTypeDef ret = HAL_I2C_Master_Transmit(&hi2c4, dsp_i2c_address, i2c_msg_buffer, 2, 2);
	assert(ret == HAL_OK);
	ret = HAL_I2C_Master_Receive(&hi2c4, dsp_i2c_address, i2c_debug_buffer, length, 2);
	assert(ret == HAL_OK);
	if(0 != memcmp(reg_buffer, i2c_debug_buffer, length))
	{
		return HAL_ERROR;
	}
	return ret;
}

void audio_dsp_check_device_id(void)
{
	uint8_t expected_id[3] = {0x41, 0x17, 0x87};
	audio_dsp_adau1787_reg_check(0xc000, expected_id,3);
}

void audio_dsp_load_default(void) //This function to load the dsp configure to AUAU1787 via I2C
{
	uint16_t index = 0;
	uint16_t local_reg;
	uint8_t local_data;

	for(index=0; index<DSP_REG_DATA_LENGTH;index++)
	{
		local_reg = reg_data[index].reg_16bit;
		local_data = reg_data[index].data_8bit;
		audio_dsp_adau1787_reg_write(local_reg, &local_data, 1);

		if(reg_data[index].reg_16bit == 0xC007)
		{
			HAL_Delay(2);
		}
	}

	for(index=0; index<DSP_PROGRAM_DATA_5000_LENGTH;index++)
	{
		audio_dsp_adau1787_reg_write((0x5000+index),&(Program_Data_5000[index]),1);
	}


	for(index=0; index<DSP_PARAMETER_DATA_2000_LENGTH;index++)
	{
		audio_dsp_adau1787_reg_write((0x2000+index),&(Parameter_Data_2000[index]),1);
	}
	for(index=0; index<DSP_REG_DATA_2_LENGTH;index++)
	{
		local_reg = reg_data2[index].reg_16bit;
		local_data = reg_data2[index].data_8bit;
		audio_dsp_adau1787_reg_write(local_reg,&local_data,1);	
	}

	HAL_Delay(2);
}

int audio_dsp_chip_init(void)
{	
  int status = HAL_I2C_IsDeviceReady(&hi2c4, dsp_i2c_address, 1, 1000);

  if (status == HAL_OK)
  {
	audio_dsp_check_device_id();
	audio_dsp_load_default();
  }

  return status;
}
//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑